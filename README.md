# Simple REST service witch SSL (JKS) & SpringBoot dedicated to dynamic client certificate selection

### Choices
* JDK 8
* SpringBoot v.1.5.2
* SSL based on Java Keystore

### About
This example project demonstrates how to use two-way SSL connection with multiple client certificates.

The SSL connection requires us to generate client and server keys and certificates. 
Server key/cert are stored in server keystore and client keys/certs are stored in server truststore. 
On client side it looks reversely. Server key/cert are stored inside client truststore and client keys/certs are stored in client keystore.
If you want you can keep both inside keystore, but recommended is to separate it's.

You shouldn't have the keystore/truststore inside your jar/war, they need to be located on the filesystem. 
This project keeps both inside resources directory but it's only for demonstration.

This implementation of SSL is based on Java Key Store repository (JKS). In simple word JKS is a database for keys and certificates.

More info is located in [client](https://github.com/dalgim/dynamic-cert-ssl-client) implementation for this simple service.

## How to use
### Certificate generation 
First of all we must generate client and server certificates. Certificates will be generate using _keytool_ provided by JDK.
Certificates generated by the following commands will be also used in [client](https://github.com/dalgim/dynamic-cert-ssl-client) 

#### Step-by-step
Generate server keypair and put them into _server-keystore.jks_ file
 ```sh
 keytool -genkeypair -alias serverkey -keyalg RSA -keypass password -keystore server-keystore.jks -storepass password
  ```
Export generated server certificate from created _server-keystore.jks_ into _server-public.cer_ file
 ```sh
 keytool -exportcert -alias serverkey -file server-public.cer -keystore server-keystore.jks -storepass password
  ```
Now we can import exported server certificate into _client-truststore.jks_ which will be used to authenticate server.
 ```sh
keytool -importcert -keystore client-truststore.jks -alias serverkey -file server-public.cer -storepass password -noprompt
  ```
Now we're ready to generate client certificates. In this case we want to use multiple certification on client side.
It means that the client select a specific certificate used some condition base on your business case (More information in client README).

In our case we generate three example certificates. We put them into one _client-keystore.jks_ and export them into _.cer_ files.
<br/>First
```sh
 keytool -genkeypair -alias clientkey1 -keyalg RSA -keypass password -keystore client-keystore.jks -storepass password
```
```sh
keytool -exportcert -alias clientkey1 -file client-public1.cer -keystore client-keystore.jks -storepass password
```
<br/>Second
```sh
 keytool -genkeypair -alias clientkey2 -keyalg RSA -keypass password -keystore client-keystore.jks -storepass password
```
```sh
keytool -exportcert -alias clientkey2 -file client-public2.cer -keystore client-keystore.jks -storepass password
```
<br/>Third
```sh
 keytool -genkeypair -alias clientkey3 -keyalg RSA -keypass password -keystore client-keystore.jks -storepass password
```
```sh
keytool -exportcert -alias clientkey3 -file client-public3.cer -keystore client-keystore.jks -storepass password
```
Now this exported certificates we must import into _server-truststore.jks_.
```sh
keytool -importcert -keystore server-truststore.jks -alias clientcert1 -file client-public1.cer -storepass password -noprompt
```
```sh
keytool -importcert -keystore server-truststore.jks -alias clientcert2 -file client-public3.cer -storepass password -noprompt
```
```sh
keytool -importcert -keystore server-truststore.jks -alias clientcert3 -file client-public3.cer -storepass password -noprompt
```

Client and server certficates are ready to use. You can delete all exported certs because they will not need.

### SSL properties configuration

Spring boot applications supports SSL by application properties. You can check [documentation](https://docs.spring.io/spring-boot/docs/current/reference/html/howto-embedded-servlet-containers.html)

Our configuration looks like following
```properties
server:  
    ssl:
        "key-store" : 'classpath:ssl/server-keystore.jks'
        "key-store-password" : 'password'
        "key-password" : 'password'
        "client-auth" : 'need'
        "trust-store" : 'classpath:ssl/server-truststore.jks'
        "trust-store-password" : 'password'
```
### Building and running application

Run "mvn clean install"
```sh
mvn clean install
```
next
```sh
mvn spring-boot:run
```
the simple service is running on https://localhost:8443/api/

Now for testing you must configure and run client.